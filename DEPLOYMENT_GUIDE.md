# üöÄ Panduan Deployment Exora ID

## Ringkasan Project
Exora ID adalah sistem manajemen file berbasis cloud yang menggunakan:
- **Backend**: Node.js + Express
- **Database**: PostgreSQL
- **Storage**: CloudKilat S3-Compatible Storage
- **Authentication**: JWT

## üìã Prasyarat
- Akun hosting (pilih salah satu di bawah)
- PostgreSQL database (bisa dari hosting atau service terpisah)
- CloudKilat Storage credentials
- Git repository (GitHub/GitLab)

---

## üéØ Opsi Hosting (Rekomendasi)

### 1. Railway.app (‚≠ê RECOMMENDED - Paling Mudah)
**Kelebihan:**
- ‚úÖ Free tier sangat generous
- ‚úÖ Auto-deploy dari GitHub
- ‚úÖ PostgreSQL included
- ‚úÖ Setup sangat mudah
- ‚úÖ Custom domain gratis

**Langkah Deploy:**

1. **Persiapan Repository:**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-github-repo-url>
   git push -u origin main
   ```

2. **Deploy ke Railway:**
   - Buka https://railway.app
   - Klik "Start a New Project"
   - Pilih "Deploy from GitHub repo"
   - Pilih repository Exora ID
   - Railway akan auto-detect sebagai Node.js app

3. **Tambah PostgreSQL Database:**
   - Di dashboard Railway, klik "New"
   - Pilih "Database" ‚Üí "PostgreSQL"
   - Railway akan auto-generate `DATABASE_URL`

4. **Set Environment Variables:**
   - Klik service Exora ID ‚Üí "Variables"
   - Tambahkan semua variable dari `.env.example`:
   ```
   CLOUDKILAT_S3_ENDPOINT=https://s3-id-jkt-1.kilatstorage.id
   CLOUDKILAT_ACCESS_KEY=<your-access-key>
   CLOUDKILAT_SECRET_KEY=<your-secret-key>
   S3_BUCKET_NAME=Exora ID-storage
   JWT_SECRET=<generate-random-string>
   PORT=3000
   NODE_ENV=production
   DATABASE_URL=<auto-generated-by-railway>
   ```

5. **Setup Database Schema:**
   - Setelah deploy berhasil, buka Railway PostgreSQL
   - Klik "Query" atau gunakan psql
   - Jalankan isi file `schema.sql`

6. **Akses Aplikasi:**
   - Railway akan memberikan URL: `https://Exora ID-production.up.railway.app`
   - Atau setup custom domain di Settings

---

### 2. Render.com (Alternatif Bagus)
**Kelebihan:**
- ‚úÖ Free tier tersedia
- ‚úÖ Auto-deploy dari Git
- ‚úÖ PostgreSQL tersedia
- ‚úÖ SSL otomatis

**Langkah Deploy:**

1. Push code ke GitHub (sama seperti Railway)

2. **Deploy Web Service:**
   - Buka https://render.com
   - Klik "New +" ‚Üí "Web Service"
   - Connect repository GitHub
   - Konfigurasi:
     - **Name**: Exora ID
     - **Environment**: Node
     - **Build Command**: `npm install`
     - **Start Command**: `npm start`
     - **Plan**: Free

3. **Tambah PostgreSQL:**
   - Dashboard ‚Üí "New +" ‚Üí "PostgreSQL"
   - Nama: Exora ID-db
   - Copy "Internal Database URL"

4. **Environment Variables:**
   - Masuk ke Web Service Settings ‚Üí Environment
   - Tambahkan semua variable (sama seperti Railway)
   - Untuk `DATABASE_URL`, gunakan Internal Database URL

5. **Setup Database:**
   - Gunakan Render PostgreSQL Dashboard atau psql
   - Jalankan `schema.sql`

---

### 3. Vercel + Supabase (Serverless)
**Kelebihan:**
- ‚úÖ Sangat cepat
- ‚úÖ Supabase PostgreSQL gratis
- ‚úÖ Global CDN

**Catatan:** Perlu modifikasi kode karena Vercel serverless

**Langkah Deploy:**

1. Install Vercel CLI:
   ```bash
   npm i -g vercel
   ```

2. Buat file `vercel.json`:
   (Sudah dibuat otomatis)

3. Setup Supabase:
   - Buka https://supabase.com
   - Create new project
   - Copy PostgreSQL connection string
   - Jalankan `schema.sql` di SQL Editor

4. Deploy:
   ```bash
   vercel
   ```

5. Set Environment Variables:
   ```bash
   vercel env add CLOUDKILAT_ACCESS_KEY
   vercel env add CLOUDKILAT_SECRET_KEY
   # ... dst
   ```

---

### 4. Heroku (Classic)
**Kelebihan:**
- ‚úÖ Sudah terbukti stabil
- ‚úÖ Add-ons banyak

**Kekurangan:**
- ‚ùå Free tier dihapus (minimal $5/bulan)

**Langkah Deploy:**

1. Install Heroku CLI:
   ```bash
   npm install -g heroku
   ```

2. Login dan create app:
   ```bash
   heroku login
   heroku create Exora ID
   ```

3. Add PostgreSQL:
   ```bash
   heroku addons:create heroku-postgresql:mini
   ```

4. Set Config Vars:
   ```bash
   heroku config:set CLOUDKILAT_S3_ENDPOINT=https://s3-id-jkt-1.kilatstorage.id
   heroku config:set CLOUDKILAT_ACCESS_KEY=<your-key>
   heroku config:set CLOUDKILAT_SECRET_KEY=<your-secret>
   heroku config:set S3_BUCKET_NAME=Exora ID-storage
   heroku config:set JWT_SECRET=<random-string>
   heroku config:set NODE_ENV=production
   ```

5. Deploy:
   ```bash
   git push heroku main
   ```

6. Setup Database:
   ```bash
   heroku pg:psql < schema.sql
   ```

---

### 5. VPS (DigitalOcean, Linode, Vultr)
**Kelebihan:**
- ‚úÖ Full control
- ‚úÖ Bisa untuk banyak aplikasi
- ‚úÖ Performa tinggi

**Kekurangan:**
- ‚ùå Perlu setup manual
- ‚ùå Perlu maintenance sendiri

**Langkah Deploy (Ubuntu):**

1. **Setup VPS:**
   ```bash
   # Update system
   sudo apt update && sudo apt upgrade -y
   
   # Install Node.js
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt install -y nodejs
   
   # Install PostgreSQL
   sudo apt install -y postgresql postgresql-contrib
   
   # Install Nginx
   sudo apt install -y nginx
   
   # Install PM2
   sudo npm install -g pm2
   ```

2. **Setup PostgreSQL:**
   ```bash
   sudo -u postgres psql
   CREATE DATABASE Exora ID;
   CREATE USER Exora ID_user WITH PASSWORD 'strong_password';
   GRANT ALL PRIVILEGES ON DATABASE Exora ID TO Exora ID_user;
   \q
   ```

3. **Deploy Aplikasi:**
   ```bash
   cd /var/www
   git clone <your-repo-url> Exora ID
   cd Exora ID
   npm install --production
   
   # Setup .env
   nano .env
   # Paste semua environment variables
   ```

4. **Setup PM2:**
   ```bash
   pm2 start server.js --name Exora ID
   pm2 startup
   pm2 save
   ```

5. **Setup Nginx:**
   ```bash
   sudo nano /etc/nginx/sites-available/Exora ID
   ```
   
   Paste konfigurasi (file nginx.conf sudah dibuat)

   ```bash
   sudo ln -s /etc/nginx/sites-available/Exora ID /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

6. **Setup SSL (Let's Encrypt):**
   ```bash
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d yourdomain.com
   ```

---

## üîê Keamanan Production

### 1. Environment Variables
**PENTING:** Jangan pernah commit file `.env` ke Git!

Pastikan `.gitignore` sudah include:
```
.env
.env.local
.env.production
node_modules/
```

### 2. Generate JWT Secret yang Kuat
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### 3. CORS Configuration
Untuk production, edit `server.js` CORS settings:
```javascript
app.use(cors({
  origin: 'https://yourdomain.com', // Domain frontend Anda
  credentials: true
}));
```

### 4. Rate Limiting (Opsional tapi Recommended)
Install:
```bash
npm install express-rate-limit
```

---

## üìä Monitoring & Logs

### Railway/Render
- Built-in logs di dashboard
- Metrics otomatis tersedia

### VPS (PM2)
```bash
pm2 logs Exora ID     # Lihat logs
pm2 monit             # Monitor real-time
pm2 status            # Status aplikasi
```

---

## üß™ Testing Setelah Deploy

1. **Health Check:**
   ```bash
   curl https://your-app-url.com/api/health
   ```

2. **Test Register:**
   ```bash
   curl -X POST https://your-app-url.com/api/auth/register \
     -H "Content-Type: application/json" \
     -d '{"email":"test@test.com","password":"test123","username":"testuser"}'
   ```

3. **Buka di Browser:**
   - https://your-app-url.com

---

## üÜò Troubleshooting

### Error: Database Connection Failed
- Cek `DATABASE_URL` di environment variables
- Pastikan PostgreSQL sudah running
- Cek firewall/security groups

### Error: CloudKilat Upload Failed
- Verify `CLOUDKILAT_ACCESS_KEY` dan `SECRET_KEY`
- Cek bucket name benar
- Test koneksi dengan `test-cloudkilat.js`

### Error: 502 Bad Gateway (VPS)
- Cek PM2: `pm2 status`
- Cek Nginx: `sudo nginx -t`
- Cek logs: `pm2 logs`

### Application Crash
- Lihat logs di hosting dashboard
- Cek environment variables lengkap
- Pastikan database schema sudah dijalankan

---

## üìû Support

Jika ada masalah:
1. Cek logs terlebih dahulu
2. Verifikasi environment variables
3. Test koneksi database dan storage
4. Baca dokumentasi hosting yang digunakan

---

## üéâ Rekomendasi Final

**Untuk Pemula:** Railway.app - Paling mudah dan lengkap
**Untuk Production Serius:** VPS dengan Nginx + PM2
**Untuk Serverless:** Vercel + Supabase (perlu modifikasi kode)

**Setup Tercepat (5-10 menit):**
1. Push ke GitHub
2. Connect ke Railway
3. Add PostgreSQL
4. Set environment variables
5. Deploy! üöÄ
